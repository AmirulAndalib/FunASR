<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WebSocket/gRPC Communication Protocol &mdash; FunASR  documentation</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            FunASR
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/docker.html">Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">Quick Start</a></li>
</ul>
<p class="caption"><span class="caption-text">Academic Egs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/asr_recipe.html">Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/punc_recipe.html">Punctuation Restoration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/vad_recipe.html">Voice Activity Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/sv_recipe.html">Speaker Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/sd_recipe.html">Speaker Diarization</a></li>
</ul>
<p class="caption"><span class="caption-text">ModelScope Egs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modelscope_pipeline/quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../egs_modelscope/asr/TEMPLATE/README.html">Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../egs_modelscope/vad/TEMPLATE/README.html">Voice Activity Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../egs_modelscope/punctuation/TEMPLATE/README.html">Punctuation Restoration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../egs_modelscope/tp/TEMPLATE/README.html">Timestamp Prediction (FA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelscope_pipeline/sv_pipeline.html">Speaker Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelscope_pipeline/sd_pipeline.html">Speaker Diarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelscope_pipeline/itn_pipeline.html">Inverse Text Normalization (ITN)</a></li>
</ul>
<p class="caption"><span class="caption-text">Model Zoo</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../model_zoo/modelscope_models.html">Pretrained Models Released on ModelScope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model_zoo/huggingface_models.html">Pretrained Models on Huggingface</a></li>
</ul>
<p class="caption"><span class="caption-text">Runtime and Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">FunASR Runtime Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDK_tutorial_online.html">FunASR Realtime Transcribe Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDK_tutorial.html">Highlights</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDK_tutorial.html#funasr-offline-file-transcription-service">FunASR Offline File Transcription Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../html5/readme.html">Speech Recognition Service Html5 Client Access Interface</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark and Leaderboard</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark/benchmark_onnx.html">CPU Benchmark (ONNX-python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark/benchmark_onnx_cpp.html">CPU Benchmark (ONNX-cpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark/benchmark_libtorch.html">CPU Benchmark (Libtorch)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark/benchmark_pipeline_cer.html">Leaderboard IO</a></li>
</ul>
<p class="caption"><span class="caption-text">Funasr Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/build_task.html">Build custom tasks</a></li>
</ul>
<p class="caption"><span class="caption-text">Papers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/papers.html">Papers</a></li>
</ul>
<p class="caption"><span class="caption-text">Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/application.html">Audio Cut</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/application.html#realtime-speech-recognition">Realtime Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/application.html#audio-chat">Audio Chat</a></li>
</ul>
<p class="caption"><span class="caption-text">FQA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/FQA.html">FQA</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">FunASR</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">WebSocket/gRPC Communication Protocol</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/funasr/runtime/docs/websocket_protocol.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>(<a class="reference internal" href="websocket_protocol_zh.html"><span class="doc">简体中文</span></a>|English)</p>
<div class="section" id="websocket-grpc-communication-protocol">
<h1>WebSocket/gRPC Communication Protocol<a class="headerlink" href="#websocket-grpc-communication-protocol" title="Permalink to this headline"></a></h1>
<p>This protocol is the communication protocol for the FunASR software package, which includes offline file transcription (<a class="reference internal" href="SDK_tutorial.html"><span class="doc">deployment document</span></a>) and real-time speech recognition (<a class="reference internal" href="SDK_tutorial_online.html"><span class="doc">deployment document</span></a>).</p>
<div class="section" id="offline-file-transcription">
<h2>Offline File Transcription<a class="headerlink" href="#offline-file-transcription" title="Permalink to this headline"></a></h2>
<div class="section" id="sending-data-from-client-to-server">
<h3>Sending Data from Client to Server<a class="headerlink" href="#sending-data-from-client-to-server" title="Permalink to this headline"></a></h3>
<div class="section" id="message-format">
<h4>Message Format<a class="headerlink" href="#message-format" title="Permalink to this headline"></a></h4>
<p>Configuration parameters and meta information are in JSON format, while audio data is in bytes.</p>
</div>
<div class="section" id="initial-communication">
<h4>Initial Communication<a class="headerlink" href="#initial-communication" title="Permalink to this headline"></a></h4>
<p>The message (which needs to be serialized in JSON) is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&quot;mode&quot;: &quot;offline&quot;, &quot;wav_name&quot;: &quot;wav_name&quot;,&quot;wav_format&quot;:&quot;pcm&quot;,&quot;is_speaking&quot;: True,&quot;wav_format&quot;:&quot;pcm&quot;,&quot;hotwords&quot;:&quot;阿里巴巴 达摩院 阿里云&quot;,&quot;itn&quot;:true}
</pre></div>
</div>
<p>Parameter explanation:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>`mode`: `offline`, indicating the inference mode for offline file transcription
`wav_name`: the name of the audio file to be transcribed
`wav_format`: the audio and video file extension, such as pcm, mp3, mp4, etc.
`is_speaking`: False indicates the end of a sentence, such as a VAD segmentation point or the end of a WAV file
`audio_fs`: when the input audio is in PCM format, the audio sampling rate parameter needs to be added
`hotwords`：If AM is the hotword model, hotword data needs to be sent to the server in string format, with &quot; &quot; used as a separator between hotwords. For example：&quot;阿里巴巴 达摩院 阿里云&quot;
`itn`: whether to use itn, the default value is true for enabling and false for disabling.
</pre></div>
</div>
</div>
<div class="section" id="sending-audio-data">
<h4>Sending Audio Data<a class="headerlink" href="#sending-audio-data" title="Permalink to this headline"></a></h4>
<p>For PCM format, directly send the audio data. For other audio formats, send the header information and audio and video bytes data together. Multiple sampling rates and audio and video formats are supported.</p>
</div>
<div class="section" id="sending-end-of-audio-flag">
<h4>Sending End of Audio Flag<a class="headerlink" href="#sending-end-of-audio-flag" title="Permalink to this headline"></a></h4>
<p>After sending the audio data, an end-of-audio flag needs to be sent (which needs to be serialized in JSON):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&quot;is_speaking&quot;: False}
</pre></div>
</div>
</div>
</div>
<div class="section" id="sending-data-from-server-to-client">
<h3>Sending Data from Server to Client<a class="headerlink" href="#sending-data-from-server-to-client" title="Permalink to this headline"></a></h3>
<div class="section" id="sending-recognition-results">
<h4>Sending Recognition Results<a class="headerlink" href="#sending-recognition-results" title="Permalink to this headline"></a></h4>
<p>The message (serialized in JSON) is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&quot;mode&quot;: &quot;offline&quot;, &quot;wav_name&quot;: &quot;wav_name&quot;, &quot;text&quot;: &quot;asr ouputs&quot;, &quot;is_final&quot;: True, &quot;timestamp&quot;:&quot;[[100,200], [200,500]]&quot;}
</pre></div>
</div>
<p>Parameter explanation:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>`mode`: `offline`, indicating the inference mode for offline file transcription
`wav_name`: the name of the audio file to be transcribed
`text`: the text output of speech recognition
`is_final`: indicating the end of recognition
`timestamp`：If AM is a timestamp model, it will return this field, indicating the timestamp, in the format of &quot;[[100,200], [200,500]]&quot;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="real-time-speech-recognition">
<h2>Real-time Speech Recognition<a class="headerlink" href="#real-time-speech-recognition" title="Permalink to this headline"></a></h2>
<div class="section" id="system-architecture-diagram">
<h3>System Architecture Diagram<a class="headerlink" href="#system-architecture-diagram" title="Permalink to this headline"></a></h3>
<div align="left"><img src="images/2pass.jpg" width="600"/></div></div>
<div class="section" id="id1">
<h3>Sending Data from Client to Server<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h3>
<div class="section" id="id2">
<h4>Message Format<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h4>
<p>Configuration parameters and meta information are in JSON format, while audio data is in bytes.</p>
</div>
<div class="section" id="id3">
<h4>Initial Communication<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h4>
<p>The message (which needs to be serialized in JSON) is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&quot;mode&quot;: &quot;2pass&quot;, &quot;wav_name&quot;: &quot;wav_name&quot;, &quot;is_speaking&quot;: True, &quot;wav_format&quot;:&quot;pcm&quot;, &quot;chunk_size&quot;:[5,10,5],&quot;hotwords&quot;:&quot;阿里巴巴 达摩院 阿里云&quot;,&quot;itn&quot;:true}
</pre></div>
</div>
<p>Parameter explanation:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>`mode`: `offline` indicates the inference mode for single-sentence recognition; `online` indicates the inference mode for real-time speech recognition; `2pass` indicates real-time speech recognition and offline model correction for sentence endings.
`wav_name`: the name of the audio file to be transcribed
`wav_format`: the audio and video file extension, such as pcm, mp3, mp4, etc. (Note: only PCM audio streams are supported in version 1.0)
`is_speaking`: False indicates the end of a sentence, such as a VAD segmentation point or the end of a WAV file
`chunk_size`: indicates the latency configuration of the streaming model, `[5,10,5]` indicates that the current audio is 600ms long, with a 300ms look-ahead and look-back time.
`audio_fs`: when the input audio is in PCM format, the audio sampling rate parameter needs to be added
`hotwords`：If AM is the hotword model, hotword data needs to be sent to the server in string format, with &quot; &quot; used as a separator between hotwords. For example：&quot;阿里巴巴 达摩院 阿里云&quot;
`itn`: whether to use itn, the default value is true for enabling and false for disabling.
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>Sending Audio Data<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h4>
<p>Directly send the audio data, removing the header information and sending only the bytes data. Supported audio sampling rates are 8000 (which needs to be specified as audio_fs in message), and 16000.</p>
</div>
<div class="section" id="id5">
<h4>Sending End of Audio Flag<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h4>
<p>After sending the audio data, an end-of-audio flag needs to be sent (which needs to be serialized in JSON):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&quot;is_speaking&quot;: False}
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h3>Sending Data from Server to Client<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h3>
<div class="section" id="id7">
<h4>Sending Recognition Results<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h4>
<p>The message (serialized in JSON) is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{&quot;mode&quot;: &quot;2pass-online&quot;, &quot;wav_name&quot;: &quot;wav_name&quot;, &quot;text&quot;: &quot;asr ouputs&quot;, &quot;is_final&quot;: True, &quot;timestamp&quot;:&quot;[[100,200], [200,500]]&quot;}
</pre></div>
</div>
<p>Parameter explanation:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>`mode`: indicates the inference mode, divided into `2pass-online` for real-time recognition results and `2pass-offline` for 2-pass corrected recognition results.
`wav_name`: the name of the audio file to be transcribed
`text`: the text output of speech recognition
`is_final`: indicating the end of recognition
`timestamp`：If AM is a timestamp model, it will return this field, indicating the timestamp, in the format of &quot;[[100,200], [200,500]]&quot;
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Speech Lab, Alibaba Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>