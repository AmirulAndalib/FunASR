<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FunASR实时语音听写便捷部署教程 &mdash; FunASR  documentation</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            FunASR
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/docker.html">Docker</a></li>
</ul>
<p class="caption"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quick_start.html">Quick Start</a></li>
</ul>
<p class="caption"><span class="caption-text">Academic Egs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/asr_recipe.html">Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/punc_recipe.html">Punctuation Restoration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/vad_recipe.html">Voice Activity Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/sv_recipe.html">Speaker Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../academic_recipe/sd_recipe.html">Speaker Diarization</a></li>
</ul>
<p class="caption"><span class="caption-text">ModelScope Egs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modelscope_pipeline/quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../egs_modelscope/asr/TEMPLATE/README.html">Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../egs_modelscope/vad/TEMPLATE/README.html">Voice Activity Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../egs_modelscope/punctuation/TEMPLATE/README.html">Punctuation Restoration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../egs_modelscope/tp/TEMPLATE/README.html">Timestamp Prediction (FA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelscope_pipeline/sv_pipeline.html">Speaker Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelscope_pipeline/sd_pipeline.html">Speaker Diarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelscope_pipeline/itn_pipeline.html">Inverse Text Normalization (ITN)</a></li>
</ul>
<p class="caption"><span class="caption-text">Model Zoo</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../model_zoo/modelscope_models.html">Pretrained Models on ModelScope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../model_zoo/huggingface_models.html">Pretrained Models on Huggingface</a></li>
</ul>
<p class="caption"><span class="caption-text">Runtime and Service</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">FunASR Runtime Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDK_tutorial_online.html">FunASR Realtime Transcribe Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDK_tutorial.html">FunASR Offline File Transcription Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../html5/readme.html">Speech Recognition Service Html5 Client Access Interface</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark and Leaderboard</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark/benchmark_onnx.html">CPU Benchmark (ONNX-python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark/benchmark_onnx_cpp.html">CPU Benchmark (ONNX-cpp)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark/benchmark_libtorch.html">CPU Benchmark (Libtorch)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../benchmark/benchmark_pipeline_cer.html">Leaderboard IO</a></li>
</ul>
<p class="caption"><span class="caption-text">Funasr Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/build_task.html">Build custom tasks</a></li>
</ul>
<p class="caption"><span class="caption-text">Papers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/papers.html">Papers</a></li>
</ul>
<p class="caption"><span class="caption-text">Application</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/application.html">Audio Cut</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/application.html#realtime-speech-recognition">Realtime Speech Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/application.html#audio-chat">Audio Chat</a></li>
</ul>
<p class="caption"><span class="caption-text">FQA</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/FQA.html">FQA</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">FunASR</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">FunASR实时语音听写便捷部署教程</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/funasr/runtime/docs/SDK_tutorial_online_zh.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>(简体中文|<a class="reference internal" href="SDK_tutorial_online.html"><span class="doc">English</span></a>)</p>
<div class="section" id="funasr">
<h1>FunASR实时语音听写便捷部署教程<a class="headerlink" href="#funasr" title="Permalink to this headline"></a></h1>
<p>FunASR提供可便捷本地或者云端服务器部署的实时语音听写服务，内核为FunASR已开源的runtime-SDK。
FunASR集成了达摩院语音实验室在Modelscope社区开源的语音端点检测(VAD)、Paraformer-large非流式语音识别(ASR)、Paraformer-large流式语音识别(ASR)、标点预测(PUNC) 等相关能力。软件包既可以实时地进行语音转文字，而且能够在说话句尾用高精度的转写文字修正输出，输出文字带有标点，支持高并发多路请求</p>
<div class="section" id="id1">
<h2>服务器配置<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h2>
<p>用户可以根据自己的业务需求，选择合适的服务器配置，推荐配置为：</p>
<ul class="simple">
<li><p>配置1: （X86，计算型），4核vCPU，内存8G，单机可以支持大约16路的请求</p></li>
<li><p>配置2: （X86，计算型），16核vCPU，内存32G，单机可以支持大约32路的请求</p></li>
<li><p>配置3: （X86，计算型），64核vCPU，内存128G，单机可以支持大约100路的请求</p></li>
</ul>
<p>详细性能测试报告（<a class="reference internal" href="benchmark_onnx_cpp.html"><span class="doc">点击此处</span></a>）</p>
<p>云服务厂商，针对新用户，有3个月免费试用活动，申请教程（<a class="reference external" href="https://github.com/alibaba-damo-academy/FunASR/blob/main/funasr/runtime/docs/aliyun_server_tutorial.md">点击此处</a>）</p>
</div>
<div class="section" id="id2">
<h2>快速上手<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<div class="section" id="id3">
<h3>服务端启动<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">注意</span></code>：一键部署工具，过程分为：安装docker、下载docker镜像、启动服务。如果用户希望直接从FunASR docker镜像启动，可以参考开发指南（<a class="reference internal" href="SDK_advanced_guide_online_zh.html"><span class="doc">点击此处</span></a>）</p>
<p>下载部署工具<code class="docutils literal notranslate"><span class="pre">funasr-runtime-deploy-online-cpu-zh.sh</span></code></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl -O https://raw.githubusercontent.com/alibaba-damo-academy/FunASR/main/funasr/runtime/deploy_tools/funasr-runtime-deploy-online-cpu-zh.sh<span class="p">;</span>
<span class="c1"># 如遇到网络问题，中国大陆用户，可以使用下面的命令：</span>
<span class="c1"># curl -O https://isv-data.oss-cn-hangzhou.aliyuncs.com/ics/MaaS/ASR/shell/funasr-runtime-deploy-online-cpu-zh.sh;</span>
</pre></div>
</div>
<p>执行部署工具，在提示处输入回车键即可完成服务端安装与部署。目前便捷部署工具暂时仅支持Linux环境，其他环境部署参考开发指南（点击此处）</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo bash funasr-runtime-deploy-online-cpu-zh.sh install --workspace ./funasr-runtime-resources
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>客户端测试与使用<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h3>
<p>运行上面安装指令后，会在./funasr-runtime-resources（默认安装目录）中下载客户端测试工具目录samples（手动下载，<a class="reference external" href="https://isv-data.oss-cn-hangzhou.aliyuncs.com/ics/MaaS/ASR/sample/funasr_samples.tar.gz">点击此处</a>），
我们以Python语言客户端为例，支持麦克风输入，其他版本客户端请参考文档（点击此处）</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 funasr_wss_client.py --host <span class="s2">&quot;127.0.0.1&quot;</span> --port <span class="m">10095</span> --mode 2pass
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h2>客户端用法详解<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h2>
<p>在服务器上完成FunASR服务部署以后，可以通过如下的步骤来测试和使用实时语音听写服务。
目前分别支持以下几种编程语言客户端</p>
<ul class="simple">
<li><p><a class="reference internal" href="#python-client"><span class="std std-ref">Python</span></a></p></li>
<li><p><a class="reference internal" href="#cpp-client"><span class="std std-ref">CPP</span></a></p></li>
<li><p><a class="reference internal" href="#html-client"><span class="std std-ref">html</span></a></p></li>
<li><p><a class="reference internal" href="#java-client"><span class="std std-ref">java</span></a></p></li>
<li><p>c#</p></li>
</ul>
<p>更多版本客户端支持请参考<a class="reference internal" href="websocket_protocol_zh.html"><span class="doc">websocket/grpc协议</span></a></p>
<div class="section" id="python-client">
<h3>python-client<a class="headerlink" href="#python-client" title="Permalink to this headline"></a></h3>
<p>若想直接运行client进行测试，可参考如下简易说明，以python版本为例：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 funasr_wss_client.py --host <span class="s2">&quot;127.0.0.1&quot;</span> --port <span class="m">10095</span> --mode 2pass
</pre></div>
</div>
<p>命令参数说明：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>--host 为FunASR runtime-SDK服务部署机器ip，默认为本机ip（127.0.0.1），如果client与服务不在同一台服务器，需要改为部署机器ip
--port 10095 部署端口号
--mode：`offline`表示推理模式为一句话识别；`online`表示推理模式为实时语音识别；`2pass`表示为实时语音识别，并且说话句尾采用离线模型进行纠错。
--chunk_size：表示流式模型latency配置`[5,10,5]`，表示当前音频解码片段为600ms，并且回看300ms，右看300ms。
--audio_in 需要进行转写的音频文件，支持文件路径，文件列表wav.scp
--thread_num 设置并发发送线程数，默认为1
--ssl 设置是否开启ssl证书校验，默认1开启，设置为0关闭
</pre></div>
</div>
</div>
<div class="section" id="cpp-client">
<h3>cpp-client<a class="headerlink" href="#cpp-client" title="Permalink to this headline"></a></h3>
<p>进入samples/cpp目录后，可以用cpp进行测试，指令如下：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./funasr-wss-client-2pass --server-ip <span class="m">127</span>.0.0.1 --port <span class="m">10095</span> --mode 2pass
</pre></div>
</div>
<p>命令参数说明：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>--server-ip 为FunASR runtime-SDK服务部署机器ip，默认为本机ip（127.0.0.1），如果client与服务不在同一台服务器，需要改为部署机器ip
--port 10095 部署端口号
--mode：`offline`表示推理模式为一句话识别；`online`表示推理模式为实时语音识别；`2pass`表示为实时语音识别，并且说话句尾采用离线模型进行纠错。
--chunk-size：表示流式模型latency配置`[5,10,5]`，表示当前音频解码片段为600ms，并且回看300ms，右看300ms。
--wav-path 需要进行转写的音频文件，支持文件路径
--thread-num 设置并发发送线程数，默认为1
--is-ssl 设置是否开启ssl证书校验，默认1开启，设置为0关闭
</pre></div>
</div>
</div>
<div class="section" id="html-client">
<h3>html-client<a class="headerlink" href="#html-client" title="Permalink to this headline"></a></h3>
<p>在浏览器中打开 html/static/index.html，即可出现如下页面，支持麦克风输入与文件上传，直接进行体验</p>
<img src="images/html.png"  width="900"/></div>
<div class="section" id="java-client">
<h3>java-client<a class="headerlink" href="#java-client" title="Permalink to this headline"></a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>FunasrWsClient --host localhost --port <span class="m">10095</span> --mode 2pass
</pre></div>
</div>
<p>详细可以参考文档（<a class="reference internal" href="../java/readme.html"><span class="doc">点击此处</span></a>）</p>
</div>
</div>
<div class="section" id="id6">
<h2>服务端用法详解<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h2>
<div class="section" id="id7">
<h3>启动已经部署过的FunASR服务<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h3>
<p>一键部署后若出现重启电脑等关闭Docker的动作，可通过如下命令直接启动FunASR服务，启动配置为上次一键部署的设置。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo bash funasr-runtime-deploy-online-cpu-zh.sh start
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h3>关闭FunASR服务<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo bash funasr-runtime-deploy-online-cpu-zh.sh stop
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3>释放FunASR服务<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h3>
<p>释放已经部署的FunASR服务。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo bash funasr-runtime-deploy-online-cpu-zh.sh remove
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>重启FunASR服务<a class="headerlink" href="#id10" title="Permalink to this headline"></a></h3>
<p>根据上次一键部署的设置重启启动FunASR服务。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo bash funasr-runtime-deploy-online-cpu-zh.sh restart
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>替换模型并重启FunASR服务<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h3>
<p>替换正在使用的模型，并重新启动FunASR服务。模型需为ModelScope中的ASR/VAD/PUNC模型，或者从ModelScope中模型finetune后的模型。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo bash funasr-runtime-deploy-online-cpu-zh.sh update <span class="o">[</span>--asr_model <span class="p">|</span> --vad_model <span class="p">|</span> --punc_model<span class="o">]</span> &lt;model_id or <span class="nb">local</span> model path&gt;

e.g
sudo bash funasr-runtime-deploy-online-cpu-zh.sh update --asr_model damo/speech_paraformer-large_asr_nat-zh-cn-16k-common-vocab8404-pytorch
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h3>更新参数并重启FunASR服务<a class="headerlink" href="#id12" title="Permalink to this headline"></a></h3>
<p>更新已配置参数，并重新启动FunASR服务生效。可更新参数包括宿主机和Docker的端口号，以及推理和IO的线程数量。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo bash funasr-runtime-deploy-online-cpu-zh.sh update <span class="o">[</span>--host_port <span class="p">|</span> --docker_port<span class="o">]</span> &lt;port number&gt;
sudo bash funasr-runtime-deploy-online-cpu-zh.sh update <span class="o">[</span>--decode_thread_num <span class="p">|</span> --io_thread_num<span class="o">]</span> &lt;the number of threads&gt;
sudo bash funasr-runtime-deploy-online-cpu-zh.sh update <span class="o">[</span>--workspace<span class="o">]</span> &lt;workspace in local&gt;
sudo bash funasr-runtime-deploy-online-cpu-zh.sh update <span class="o">[</span>--ssl<span class="o">]</span> &lt;<span class="m">0</span>: close SSL<span class="p">;</span> <span class="m">1</span>: open SSL, default:1&gt;

e.g
sudo bash funasr-runtime-deploy-online-cpu-zh.sh update --decode_thread_num <span class="m">32</span>
sudo bash funasr-runtime-deploy-online-cpu-zh.sh update --workspace ./funasr-runtime-resources
</pre></div>
</div>
</div>
<div class="section" id="ssl">
<h3>关闭SSL证书<a class="headerlink" href="#ssl" title="Permalink to this headline"></a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo bash funasr-runtime-deploy-online-cpu-zh.sh update --ssl <span class="m">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id13">
<h2>联系我们<a class="headerlink" href="#id13" title="Permalink to this headline"></a></h2>
<p>在您使用过程中，如果遇到问题，欢迎加入用户群进行反馈</p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">钉钉用户群</th>
<th style="text-align: center;">微信</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><div align="left"><img src="../../../docs/images/dingding.jpg" width="250"/></td>
<td style="text-align: center;"><img src="../../../docs/images/wechat.png" width="232"/></div></td>
</tr>
</tbody>
</table></div>
<div class="section" id="demo">
<h2>视频demo<a class="headerlink" href="#demo" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="#">点击此处</a></p>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Speech Lab, Alibaba Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>